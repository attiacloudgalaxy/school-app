<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SchoolApp.iOS.Pages.StudentsPage"
             Title="Students">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <Frame Grid.Row="0" 
               BackgroundColor="{StaticResource Secondary}"
               CornerRadius="0"
               Padding="20"
               Margin="0">
            <Label 
                Text="All Students"
                FontSize="24"
                FontAttributes="Bold"
                TextColor="White"
                HorizontalOptions="Center" />
        </Frame>

        <!-- Content -->
        <RefreshView Grid.Row="1" 
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     x:Name="RefreshView">
            
            <ScrollView>
                <VerticalStackLayout Padding="15" Spacing="10">
                    
                    <!-- Search/Filter Bar -->
                    <Frame BackgroundColor="White"
                           CornerRadius="10"
                           Padding="15"
                           Margin="0,0,0,10"
                           HasShadow="True">
                        <HorizontalStackLayout Spacing="10">
                            <Label 
                                Text="ðŸ”"
                                FontSize="20"
                                VerticalOptions="Center" />
                            <Entry 
                                Placeholder="Search students..."
                                Text="{Binding SearchText}"
                                VerticalOptions="Center"
                                HorizontalOptions="FillAndExpand"
                                BackgroundColor="Transparent" />
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- Student Count -->
                    <Label 
                        Text="{Binding FilteredStudents.Count, StringFormat='Total: {0} students'}"
                        FontSize="16"
                        FontAttributes="Bold"
                        TextColor="{StaticResource Gray700}"
                        Margin="5,0,0,10" />

                    <!-- Loading Indicator -->
                    <ActivityIndicator 
                        IsRunning="{Binding IsLoading}"
                        IsVisible="{Binding IsLoading}"
                        Color="{StaticResource Secondary}"
                        HeightRequest="50"
                        WidthRequest="50"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Margin="0,50,0,0"/>

                    <!-- Students List -->
                    <CollectionView x:Name="StudentsCollectionView"
                                    ItemsSource="{Binding FilteredStudents}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="White"
                                       CornerRadius="12"
                                       Padding="15"
                                       Margin="0,0,0,10"
                                       HasShadow="True">
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                        
                                        <!-- Avatar -->
                                        <Frame Grid.Column="0"
                                               BackgroundColor="{StaticResource Primary}"
                                               CornerRadius="25"
                                               Padding="0"
                                               HeightRequest="50"
                                               WidthRequest="50"
                                               HasShadow="False"
                                               VerticalOptions="Center">
                                            <Label 
                                                Text="ðŸ‘¤"
                                                FontSize="24"
                                                HorizontalOptions="Center"
                                                VerticalOptions="Center"
                                                TextColor="White" />
                                        </Frame>

                                        <!-- Student Info -->
                                        <VerticalStackLayout Grid.Column="1" 
                                                           Spacing="5"
                                                           VerticalOptions="Center">
                                            <Label 
                                                Text="{Binding Name}"
                                                FontSize="18"
                                                FontAttributes="Bold"
                                                TextColor="{StaticResource Gray900}" />
                                            <Label 
                                                Text="{Binding ClassroomId, StringFormat='Class {0}'}"
                                                FontSize="14"
                                                TextColor="{StaticResource Gray600}" />
                                        </VerticalStackLayout>

                                        <!-- ID Badge -->
                                        <Frame Grid.Column="2"
                                               BackgroundColor="{StaticResource Gray100}"
                                               CornerRadius="8"
                                               Padding="10,5"
                                               HasShadow="False"
                                               VerticalOptions="Center">
                                            <Label 
                                                Text="{Binding Id, StringFormat='ID: {0}'}"
                                                FontSize="12"
                                                FontAttributes="Bold"
                                                TextColor="{StaticResource Gray700}" />
                                        </Frame>

                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Empty State -->
                    <VerticalStackLayout 
                        IsVisible="{Binding IsEmpty}"
                        Spacing="20"
                        Padding="30"
                        VerticalOptions="Center"
                        HorizontalOptions="Center">
                        <Label 
                            Text="ðŸ‘¥"
                            FontSize="64"
                            HorizontalOptions="Center" />
                        <Label 
                            Text="No students found"
                            FontSize="20"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"
                            TextColor="{StaticResource Gray600}" />
                        <Label 
                            Text="Try adjusting your search or pull down to refresh"
                            FontSize="14"
                            HorizontalOptions="Center"
                            TextColor="{StaticResource Gray500}"
                            HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </ScrollView>
            
        </RefreshView>
        
    </Grid>

</ContentPage>
